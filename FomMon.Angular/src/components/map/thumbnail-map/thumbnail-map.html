<app-loader
    [loading]="state() === 'idle' || state() === 'map-loading'"
    [error]="error()">
  @if (lastImgSrc()) {
    <app-loader-placeholder>
      <img [id]="imageId()"
           class="thumb-image"
           [src]="this.lastImgSrc()"
           [alt]="alt()"
      />
    </app-loader-placeholder>
  }


@if (state() === 'image-input' || state() === 'map-saved-image') {
  <img [id]="imageId()"
       class="thumb-image"
       [src]="this.imgSrcInput() ? this.imgSrcInput() : this.mapImgDataUrl()"
       [alt]="alt()"
  />
}
</app-loader>

<!-- include while loading, but css invisible -->
@if (state() === 'map-loading' || state() === 'map-ready') {
  <div class="thumb-map-wrapper">
    <mgl-map class="thumb-map"
             [class.visible]="state() === 'map-ready'"
             [attributionControl]="false"
             [style]="thumbnailStyle()"
             [transformRequest]="mapDisplayService.transformLocalUrl"
             [interactive]="false"
             [fitBounds]="bbox()"
             [fitBoundsOptions]="{
              padding: 10,
              duration: 0
            }"
             (mapLoad)="onMapLoad($event)">

      <mgl-geojson-source
        [id]="sourceId()"
        [data]="geometry()"/>

      <mgl-layer
          [source]=sourceId()
          [id]="layerIdFill()"
          type="fill"
          [paint]="{
            'fill-color': fillColor(),
            'fill-opacity': 0.5
          }"
      ></mgl-layer>
    </mgl-map>
  </div>
}